[![API: tests & dev deploy](https://github.com/sykefi/PRTR/workflows/API%3A%20tests%20%26%20dev%20deploy/badge.svg)](https://github.com/sykefi/PRTR/actions)
[![UI: tests & dev deploy](https://github.com/sykefi/PRTR/workflows/UI%3A%20tests%20%26%20dev%20deploy/badge.svg)](https://github.com/sykefi/PRTR/actions)

# PRTR

A project for handling the European Pollutant Release and Transfer Register (i.e. E-PRTR) data and publishing it as a national web service (API & user interface). The project is funded by the [Ministry of the Environment](https://ym.fi/en/front-page) and implemented by the [Finnish Environment Institute](https://www.syke.fi/en-US).

The development version of the UI is published at [prtr-ui-dev.azurewebsites.net](https://prtr-ui-dev.azurewebsites.net/).

The development version of the API (serving only Finnish PRTR data) is published at [prtr-api-dev.azurewebsites.net](https://prtr-api-dev.azurewebsites.net/docs).

A prototype of the user interface (or portal) is published at [prtr.fi](http://prtr.fi/).

## Getting Started with the UI

This project was bootstrapped with [Create React App](https://github.com/facebook/create-react-app). See the autogenerated documentation in the other [README.md](ui/README.md)

### Prerequisites

- [Node.js](https://nodejs.org/en/)

### Installation

```
$ cd ui
$ npm install
```

### Running the app locally

`npm start`

### Running the tests

To open the interactive dashboard (Cypress) for running and debugging tests, run:

`npm run cypress`

### Configuration

By default the app uses the PRTR API at the address defined in [.env.development](ui/.env.development). To use local backend instead, you can add a new file .env.development.local and add the same environment variable there as `REACT_APP_PRTR_SERVER=http://localhost:8000`.

To disable query caching (with React Query) on local development, you can also add the environment variable `REACT_APP_PRTR_DATA_CACHE_TIME=0`.

### Code style

The project is currently formatted with [Prettier](https://prettier.io/). In VSCode, the easiest way to format is to use the plugin [prettier-vscode](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode) and the following settings:

```
{
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.formatOnSave": true
}
```

## Getting Started with the API

### Prerequisites

[Miniconda](https://docs.conda.io/en/latest/miniconda.html) or [Anaconda](https://www.anaconda.com/products/individual) package manager for Python.

### Installation

```
$ git clone https://github.com/sykefi/PRTR.git
$ cd PRTR/api
$ conda env create -f dev-env.yml
$ conda activate prtr
```

### Data import (optional)

E-PRTR data is available for download at [industry.eea.europa.eu/download](https://industry.eea.europa.eu/download) / [eea.europa.eu/data-and-maps/data](https://www.eea.europa.eu/data-and-maps/data/industrial-reporting-under-the-industrial-3) (e.g. _Industrial_Reporting_Database_v4_March_2021.accdb_). A previously imported dataset for Finland is already included as CSV files in [api/api/assets](api/api/assets).

The data import script requires installation of [driver for MS for Access files](https://www.microsoft.com/en-us/download/details.aspx?id=54920). Prior to running the script, adjust the [configuration](api/data_import/conf.py) if needed (filepath to .accdb data, country code etc.). Previously imported PRTR dataset for Finland is already included as CSV files in the path [api/api/assets](api/api/assets).

```
$ python data_import_main.py
```

### Running the server locally

```
$ uvicorn main:app --reload
```

API should now be accessible at [localhost:8000](http://localhost:8000/).

### Running the tests

```
$ python -m pytest tests/
```
